<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard - IBKR Auto-Exporter</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .profit { color: #10b981; }
        .loss { color: #ef4444; }
        
        .cal-heatmap-container {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            padding: 20px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <header class="text-center mb-10 fade-in">
            <h1 class="text-5xl font-bold text-gray-800 mb-3 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600">
                IBKR Trading Dashboard
            </h1>
            <p class="text-gray-600">Algorithmic Trading Performance ($0-$50 Cost Basis)</p>
        </header>
        
        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.1s">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total P&L</h3>
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <p id="totalPnl" class="text-3xl font-bold text-gray-800">Loading...</p>
                <p class="text-xs text-gray-500 mt-2">Lifetime earnings</p>
            </div>
            
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.2s">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Trades</h3>
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <p id="totalTrades" class="text-3xl font-bold text-gray-800">Loading...</p>
                <p class="text-xs text-gray-500 mt-2">Completed transactions</p>
            </div>
            
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.3s">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Win Rate</h3>
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                </div>
                <p id="winRate" class="text-3xl font-bold text-gray-800">Loading...</p>
                <p class="text-xs text-gray-500 mt-2">Success percentage</p>
            </div>
            
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 fade-in" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Daily Average</h3>
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                    </svg>
                </div>
                <p id="dailyAvg" class="text-3xl font-bold text-gray-800">Loading...</p>
                <p class="text-xs text-gray-500 mt-2">Per trading day</p>
            </div>
        </div>
        
        <!-- Calendar Heatmap -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 fade-in" style="animation-delay: 0.5s">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Trading Calendar 2025</h2>
            
            <div class="flex justify-center mb-6 text-sm">
                <div class="flex items-center mr-6">
                    <div class="w-4 h-4 rounded" style="background-color: #10b981"></div>
                    <span class="text-gray-600 ml-2">Profit</span>
                </div>
                <div class="flex items-center mr-6">
                    <div class="w-4 h-4 rounded" style="background-color: #ef4444"></div>
                    <span class="text-gray-600 ml-2">Loss</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 rounded" style="background-color: #e5e7eb"></div>
                    <span class="text-gray-600 ml-2">No Trades</span>
                </div>
            </div>
            
            <div id="cal-heatmap" class="cal-heatmap-container"></div>
        </div>
        
        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
            <div class="bg-white rounded-xl shadow-lg p-8 fade-in" style="animation-delay: 0.6s">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Daily P&L</h2>
                <div class="chart-container">
                    <canvas id="dailyPnlChart"></canvas>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-8 fade-in" style="animation-delay: 0.7s">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Cumulative P&L</h2>
                <div class="chart-container">
                    <canvas id="cumulativePnlChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Monthly Breakdown -->
        <div class="bg-white rounded-xl shadow-lg p-8 fade-in" style="animation-delay: 0.8s">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Monthly Performance</h2>
            <div class="chart-container" style="height: 400px;">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>
    </div>
    
    <footer class="text-center py-8 text-gray-600">
        <p>Generated on 2025-07-27</p>
        <p class="mt-2">
            <a href="https://github.com/jefrnc/ibkr-auto-exporter" class="text-blue-600 hover:underline font-medium">
                IBKR Auto-Exporter
            </a>
        </p>
    </footer>
    
    <script>
        // Load data
        fetch('dashboard-data.json')
            .then(response => response.json())
            .then(data => {
                console.log('Data loaded successfully');
                initializeDashboard(data);
            })
            .catch(error => {
                console.error('Error loading data:', error);
                // Use embedded fallback data for now
                const fallbackData = {"yearData":{},"yearStats":{"trading_days":0,"total_trades":0,"total_pnl":0,"win_rate":0,"profit_days":0,"profit_days_pct":0,"loss_days":0,"loss_days_pct":0,"best_day":"","best_day_pnl":0,"worst_day":"","worst_day_pnl":0,"daily_avg":0}};
                initializeDashboard(fallbackData);
            });
        
        function initializeDashboard(data) {
            const yearData = data.yearData || {};
            const stats = data.yearStats || {};
            
            console.log('Dashboard data loaded:', { yearData, stats });
            
            // Update metrics with animation
            animateValue('totalPnl', 0, stats.total_pnl || 0, 1000, true);
            animateValue('totalTrades', 0, stats.total_trades || 0, 1000);
            animateValue('winRate', 0, stats.win_rate || 0, 1000, false, '%');
            animateValue('dailyAvg', 0, stats.daily_avg || 0, 1000, true);
            
            // Create calendar with cal-heatmap
            createCalHeatmap(yearData);
            
            // Create charts
            createCharts(yearData);
        }
        
        function animateValue(id, start, end, duration, isCurrency = false, suffix = '') {
            const element = document.getElementById(id);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                
                let displayValue = current;
                if (isCurrency) {
                    element.textContent = '$' + displayValue.toFixed(2);
                    element.className = 'text-3xl font-bold ' + (displayValue >= 0 ? 'text-green-600' : 'text-red-600');
                } else {
                    element.textContent = displayValue.toFixed(suffix === '%' ? 1 : 0) + suffix;
                }
            }, 16);
        }
        
        function createCalHeatmap(yearData) {
            // Create a simple calendar grid instead
            const calContainer = document.getElementById('cal-heatmap');
            calContainer.innerHTML = '';
            
            // Create month containers
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const year = 2025;
            
            const gridContainer = document.createElement('div');
            gridContainer.style.display = 'flex';
            gridContainer.style.flexWrap = 'wrap';
            gridContainer.style.gap = '20px';
            gridContainer.style.justifyContent = 'center';
            
            months.forEach((monthName, monthIndex) => {
                const monthDiv = document.createElement('div');
                monthDiv.style.display = 'inline-block';
                
                const monthTitle = document.createElement('h4');
                monthTitle.textContent = monthName;
                monthTitle.style.fontSize = '14px';
                monthTitle.style.marginBottom = '5px';
                monthTitle.style.textAlign = 'center';
                monthDiv.appendChild(monthTitle);
                
                // Create days grid
                const daysGrid = document.createElement('div');
                daysGrid.style.display = 'grid';
                daysGrid.style.gridTemplateColumns = 'repeat(7, 20px)';
                daysGrid.style.gap = '2px';
                
                // Add day labels
                const dayLabels = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                dayLabels.forEach(label => {
                    const labelDiv = document.createElement('div');
                    labelDiv.textContent = label;
                    labelDiv.style.fontSize = '10px';
                    labelDiv.style.textAlign = 'center';
                    labelDiv.style.color = '#666';
                    daysGrid.appendChild(labelDiv);
                });
                
                // Get first day of month
                const firstDay = new Date(year, monthIndex, 1).getDay();
                
                // Add empty cells for alignment
                for (let i = 0; i < firstDay; i++) {
                    const emptyDiv = document.createElement('div');
                    daysGrid.appendChild(emptyDiv);
                }
                
                // Add days
                const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const dayData = yearData[dateStr];
                    
                    const dayDiv = document.createElement('div');
                    dayDiv.style.width = '20px';
                    dayDiv.style.height = '20px';
                    dayDiv.style.borderRadius = '3px';
                    dayDiv.style.cursor = 'pointer';
                    dayDiv.title = `${dateStr}: ${dayData && dayData.trades > 0 ? `$${dayData.pnl.toFixed(2)}` : 'No trades'}`;
                    
                    if (dayData && dayData.trades > 0) {
                        if (dayData.pnl > 0) {
                            dayDiv.style.backgroundColor = '#10b981';
                        } else if (dayData.pnl < 0) {
                            dayDiv.style.backgroundColor = '#ef4444';
                        } else {
                            dayDiv.style.backgroundColor = '#fbbf24';
                        }
                    } else {
                        dayDiv.style.backgroundColor = '#e5e7eb';
                    }
                    
                    dayDiv.onclick = function() {
                        if (dayData && dayData.trades > 0) {
                            alert(`Date: ${dateStr}\nTrades: ${dayData.trades}\nP&L: $${dayData.pnl.toFixed(2)}\nWin Rate: ${(dayData.winRate * 100).toFixed(1)}%`);
                        }
                    };
                    
                    daysGrid.appendChild(dayDiv);
                }
                
                monthDiv.appendChild(daysGrid);
                gridContainer.appendChild(monthDiv);
            });
            
            calContainer.appendChild(gridContainer);
        }
        
        function createCharts(yearData) {
            // Prepare data
            const dailyDates = Object.keys(yearData).filter(date => yearData[date].trades > 0).sort();
            const dailyPnl = dailyDates.map(date => yearData[date].pnl);
            
            console.log('Creating charts with dates:', dailyDates.length, 'trades');
            console.log('First few dates:', dailyDates.slice(0, 5));
            
            // Daily P&L Chart
            const ctx1 = document.getElementById('dailyPnlChart').getContext('2d');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: dailyDates.map(d => {
                        const date = new Date(d);
                        return date.toLocaleDateString('en', { month: 'short', day: 'numeric' });
                    }),
                    datasets: [{
                        label: 'Daily P&L',
                        data: dailyPnl,
                        backgroundColor: dailyPnl.map(pnl => pnl >= 0 ? 'rgba(16, 185, 129, 0.8)' : 'rgba(239, 68, 68, 0.8)'),
                        borderColor: dailyPnl.map(pnl => pnl >= 0 ? '#10b981' : '#ef4444'),
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'P&L: $' + context.raw.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            title: { display: true, text: 'P&L ($)', font: { weight: 'bold' } }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Cumulative P&L Chart
            let cumulative = 0;
            const cumulativePnl = dailyDates.map(date => {
                cumulative += yearData[date].pnl;
                return cumulative;
            });
            
            const ctx2 = document.getElementById('cumulativePnlChart').getContext('2d');
            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: dailyDates.map(d => {
                        const date = new Date(d);
                        return date.toLocaleDateString('en', { month: 'short', day: 'numeric' });
                    }),
                    datasets: [{
                        label: 'Cumulative P&L',
                        data: cumulativePnl,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Total: $' + context.raw.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            title: { display: true, text: 'Cumulative P&L ($)', font: { weight: 'bold' } }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Monthly Chart
            const monthlyData = {};
            Object.entries(yearData).forEach(([date, data]) => {
                const month = date.substring(0, 7);
                if (!monthlyData[month]) {
                    monthlyData[month] = { trades: 0, pnl: 0 };
                }
                monthlyData[month].trades += data.trades;
                monthlyData[month].pnl += data.pnl;
            });
            
            const months = Object.keys(monthlyData).sort();
            const monthlyPnl = months.map(m => monthlyData[m].pnl);
            const monthlyTrades = months.map(m => monthlyData[m].trades);
            
            const ctx3 = document.getElementById('monthlyChart').getContext('2d');
            new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: months.map(m => {
                        const [year, month] = m.split('-');
                        return new Date(year, month - 1).toLocaleDateString('en', { month: 'long', year: 'numeric' });
                    }),
                    datasets: [{
                        label: 'P&L',
                        data: monthlyPnl,
                        backgroundColor: monthlyPnl.map(pnl => pnl >= 0 ? 'rgba(16, 185, 129, 0.8)' : 'rgba(239, 68, 68, 0.8)'),
                        borderColor: monthlyPnl.map(pnl => pnl >= 0 ? '#10b981' : '#ef4444'),
                        borderWidth: 1,
                        borderRadius: 4,
                        yAxisID: 'y'
                    }, {
                        label: 'Trades',
                        data: monthlyTrades,
                        type: 'line',
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 3,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            title: { display: true, text: 'P&L ($)', font: { weight: 'bold' } }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'Number of Trades', font: { weight: 'bold' } }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>